{% extends "contact/base.html" %}{% load portal_misc %}

{% block extrahead %}{{ block.super }}
<script type="text/javascript">
var queryString = '{{ query_string|escapejs }}';
var pageNumber = {{ page.number }};
</script>
{% endblock %}

{% block content %}

{% if form.is_valid %}
<div class="section">
  <div class="header first">
    <h2>Search</h2>
  </div>
  
  <form class="content" method="get" action="{% url contact:result_list %}">
    <p>
      {{ form.query }}
    </p>
    <p>
{% for medium in medium_choices %}
      <button type="submit" name="medium" value="{{ medium.0 }}">{{ medium.1|capfirst }}</button>
{% endfor %}
    </p>
  </form>
  {% if message %}
    <div class="section notice">
      {{ message }}
    </div>
  {% endif %}

  {% if page %}
  <div class="content">
    {% if results.num_pages|gte:4 %}
    Your search returned {{ results.count }} item{{ results.count|pluralize }}. Try adding an initial to get more specific results.
    {% else %}
    Your search returned {{ results.count }} item{{ results.count|pluralize }}.
    {% endif %}

  {% if results.count %}
  {% ifnotequal 1 page_count %}
  <div class="contact-pagination-controls">
    Pages:
    {% for page_number in results.page_range %}
    <a href="?page={{ page_number }}&amp;medium={{ form.cleaned_data.medium }}&amp;query={{ form.cleaned_data.query|urlencode }}">{{ page_number }}</a>
    {% endfor %}
  </div>
  {% endifnotequal %}
  {% endif %}
    </div>
  {% if results.count %}

  <ul class="link-list{% ifequal 1 page_count %} last{% endifequal %}" id="contact-people">
    {% for person in page.object_list %}
        {% include "contact/result.html" %}
    {% endfor %}
  </ul>

  {% ifnotequal 1 page_count %}
  <div class="content last contact-pagination-controls contact-pagination-controls-bottom">
    Pages:
    {% for page_number in results.page_range %}
    <a href="?page={{ page_number }}&amp;medium={{ form.cleaned_data.medium }}&amp;query={{ form.cleaned_data.query|urlencode }}">{{ page_number }}</a>
    {% endfor %}
  </div>
  {% endifnotequal %}
  {% endif %}

{% else %}
  {% if not message %}
  <div class="note"><div class="bubble pad-10">
    Your search didn't return any results.
  </div></div>
  {% endif %}
{% endif %}
</div>

{% endif %}

{% endblock %}
